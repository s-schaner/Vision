<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VolleySense CalibMap</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="app-header">
    <h1>VolleySense CalibMap</h1>
    <div class="status-pills">
      <span id="homography-status" class="pill pill-warn">H: unset</span>
      <span id="rms-status" class="pill pill-idle">RMS: --</span>
      <span id="service-status" class="pill pill-idle">LLM: idle</span>
    </div>
  </header>
  <main class="app-main">
    <div class="panel panel-left" id="panel-left">
      <section class="player-section">
        <h2>Player</h2>
        <div class="control-row">
          <label class="file-input">
            <input type="file" id="video-input" accept="video/mp4,video/webm,video/quicktime" />
            <span>Choose Video</span>
          </label>
          <button id="play-toggle" disabled>Play</button>
          <button id="snap-frame" disabled>Grab Frame</button>
        </div>
        <div class="video-wrapper">
          <video id="video" controls crossorigin="anonymous"></video>
          <canvas id="video-overlay"></canvas>
        </div>
        <div class="timecode">Time: <span id="timecode">0.000</span>s</div>
      </section>
      <div class="splitter splitter-horizontal" id="splitter-horizontal"></div>
      <section class="calibration-section">
        <h2>Calibration</h2>
        <div class="control-grid">
          <button id="reset-calibration">Reset</button>
          <button id="confirm-h" disabled>Confirm H</button>
          <button id="pick-ball" disabled>Pick Ball</button>
          <button id="pick-net" disabled>Pick Net</button>
          <button id="pick-player" disabled>Pick Player</button>
          <button id="position-ball" disabled>Position Ball</button>
          <button id="position-player" disabled>Position Player</button>
          <label class="fit-toggle">
            <span>Fit</span>
            <select id="fit-mode">
              <option value="contain">Contain</option>
              <option value="cover">Cover</option>
            </select>
          </label>
        </div>
        <div class="calibration-canvas-wrapper">
          <canvas id="calibration-canvas"></canvas>
        </div>
      </section>
    </div>
    <div class="splitter splitter-vertical" id="splitter-vertical"></div>
    <div class="panel panel-right" id="panel-right">
      <section class="analyzer-section">
        <h2>Analyzer â€“ 2D Court</h2>
        <div class="analyzer-controls">
          <label>LLM Base URL <input id="llm-base" type="text" placeholder="http://localhost:8000" /></label>
          <label>Model <input id="llm-model" type="text" placeholder="gpt-vision" /></label>
          <div class="frame-params">
            <label>FPS <input id="frame-fps" type="number" min="1" step="1" value="6" /></label>
            <label>Resize W <input id="frame-resize-w" type="number" min="32" value="512" /></label>
            <label>Resize H <input id="frame-resize-h" type="number" min="32" value="288" /></label>
            <label>JPEG Q <input id="frame-jpegq" type="number" min="0.1" max="1" step="0.05" value="0.7" /></label>
            <label>Start (s) <input id="frame-start" type="number" min="0" step="0.1" value="0" /></label>
            <label>Duration (s) <input id="frame-duration" type="number" min="0" step="0.1" value="10" /></label>
          </div>
          <div class="analyzer-buttons">
            <button id="generate-ball" disabled>Generate Ball Track</button>
            <button id="generate-players" disabled>Generate Players</button>
            <button id="stop-analysis" disabled>Stop</button>
          </div>
          <div class="json-io">
            <label>Ball JSON <input id="ball-json-input" type="file" accept="application/json" /></label>
            <label>Humans JSON <input id="humans-json-input" type="file" accept="application/json" /></label>
            <div class="download-links">
              <a id="download-ball" href="#" download="ball_track.json">Download Ball</a>
              <a id="download-humans" href="#" download="humans.json">Download Humans</a>
            </div>
          </div>
        </div>
        <div class="court-wrapper" id="court-drop-target">
          <canvas id="court-canvas"></canvas>
        </div>
        <div class="telemetry">
          <div>t: <span id="telemetry-time">0.000</span></div>
          <div>Ball meas: <span id="telemetry-ball">--</span></div>
          <div>Ball filt: <span id="telemetry-ball-filt">--</span></div>
          <div>Ball z: <span id="telemetry-ball-z">--</span></div>
        </div>
      </section>
    </div>
  </main>
  <script src="llm_prompts.js"></script>
  <script src="app.js"></script>
</body>
</html>
